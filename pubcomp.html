<!DOCTYPE html><html><head><title>PubComp</title><script src="/socket.io/socket.io.js"></script><style type="text/css">#online, #status { float: right; }</style></head><body><div id="online"></div><div id="status"></div>
<button id="create" disabled="disabled">Getting TF2 state...</button><br/><div id="game" style="display: none;">BLU: <span id="bluscore"></span><br/>RED: <span id="redscore"></span></div>
<script>
var socket;
window.onload = function(){
	socket = new io.Socket( null, {port: 27014, rememberTransport: true} ), status = document.getElementById( 'status' ), online = document.getElementById( 'online' );
	socket.connect();
	socket.on('message', function( obj ) {
		if ( typeof obj != 'object' ) {
			return;
		}
		if ( 'numOnline' in obj ) {
			online.innerHTML = '&nbsp;' + obj.numOnline + ' users online.';
		}
		if ( 'tf' in obj ) {
			var create = document.getElementById( 'create' );
			switch ( obj.tf ) {
				case 'online':
					create.innerHTML = 'Join match';
					create.disabled = false;
					create.onclick = function(){
						socket.send( {action: 'join_match', steamid: prompt( 'Please paste your Steam Community URL here:' )} );
						setTimeout( function(){
							location.href = 'steam://connect/nightgunner5.is-a-geek.net:27015';
						}, 1000 );
					};
					break;
				default:
					create.innerHTML = 'TF2 server status: ' + obj.tf;
					create.disabled = true;
					create.onclick = function(){};
					break;
			}
		}
		if ( 'joinserver' in obj ) {
			location.href = 'steam://connect/' + obj.joinserver;
		}
		if ( 'state' in obj ) {
			var state = obj.state;
			
			if ( state.players.length ) {
				document.getElementById( 'game' ).style.display = 'block';
			} else {
				document.getElementById( 'game' ).style.display = 'none';
			}
			document.getElementById( 'bluscore' ).innerHTML = state.blueScore;
			document.getElementById( 'redscore' ).innerHTML = state.redScore;
  /*var _log = {
    blueScore: 0,
    redScore: 0,
    elapsedTime: 0,
    gameSeconds: 0,
    mapName: "",
    events: [],
    players: []
  };*/
		}
		console.log( JSON.stringify( obj ) );
	});
	socket.on('connect', function(){ status.innerHTML = 'Connected.' });
	socket.on('disconnect', function(){ status.innerHTML = 'Lost connection.' });
	socket.on('reconnect', function(){ status.innerHTML = 'Reconnected.' });
	socket.on('reconnecting', function( nextRetry ){ status.innerHTML = 'Lost connection. Retrying in ' + ( nextRetry / 1000 ) + ' seconds.'; });
};
</script></body></html>
